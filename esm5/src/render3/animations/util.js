import { AUTO_STYLE } from './tokens';
export function computeStyle(element, prop) {
    if (!window || !window.getComputedStyle)
        return '';
    var gcs = window.getComputedStyle(element);
    return readStyle(gcs, prop);
}
/**
 *
 * @param element
 * @param cb
 */
export function applyReflow(element, cb) {
    // TODO (matsko): make sure this doesn't get minified
    var w = element.clientWidth + 1;
    cb && requestAnimationFrame(function () { return cb(w); });
}
export function now() {
    return Date.now();
}
var TIMING_REGEX = /^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i;
export function parseTimingExp(exp) {
    var duration = 0;
    var delay = 0;
    var easing = null;
    if (typeof exp === 'string') {
        var matches = exp.match(TIMING_REGEX);
        if (matches === null) {
            return { duration: 0, delay: 0, easing: '', fill: null };
        }
        duration = _convertTimeValueToMS(parseFloat(matches[1]), matches[2]);
        var delayMatch = matches[3];
        if (delayMatch != null) {
            delay = _convertTimeValueToMS(parseFloat(delayMatch), matches[4]);
        }
        var easingVal = matches[5];
        if (easingVal) {
            easing = easingVal;
        }
    }
    else if (typeof exp === 'number') {
        duration = exp;
    }
    else {
        var t = exp;
        duration = t.duration;
        delay = t.delay || 0;
        easing = t.easing || null;
    }
    return { duration: duration, delay: delay, easing: easing, fill: null };
}
var ONE_SECOND = 1000;
function _convertTimeValueToMS(value, unit) {
    // only seconds are treated in a special way ...
    // otherwise it's assumed that milliseconds are used
    return unit == 's' ? value * ONE_SECOND : value;
}
export function applyTransition(element, value) {
    value ? element.style.setProperty('transition', value) :
        element.style.removeProperty('transition');
}
export function readStyle(element, prop) {
    var styles = (element instanceof Element) ? element.style : element;
    return styles[prop] || styles.getPropertyValue(prop);
}
export function hyphenateProp(prop) {
    return prop.replace(/[a-z][A-Z]/g, function (value) { return value[0] + "-" + value[1].toLowerCase(); });
}
export function applyClassChanges(element, classes, revert, store) {
    Object.keys(classes).forEach(function (className) {
        var bool = classes[className];
        element.classList.toggle(className, revert ? !bool : bool);
        if (store) {
            store[className] = revert ? false : true;
        }
    });
}
export function applyStyleChanges(element, styles, backupStyles, revert, preComputedStyles, store) {
    Object.keys(styles).forEach(function (prop) {
        var value = revert ? (backupStyles && backupStyles[prop]) : styles[prop];
        if (value && value === AUTO_STYLE) {
            value = preComputedStyles && preComputedStyles[prop] || '';
        }
        applyStyle(element, prop, value);
        if (store) {
            store[prop] = value || null;
        }
    });
}
export function applyStyle(element, prop, value) {
    if (value) {
        element.style.setProperty(prop, value);
    }
    else {
        element.style.removeProperty(prop);
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL2NvcmUvc3JjL3JlbmRlcjMvYW5pbWF0aW9ucy91dGlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQVFBLE9BQU8sRUFBQyxVQUFVLEVBQUMsTUFBTSxVQUFVLENBQUM7QUFFcEMsTUFBTSxVQUFVLFlBQVksQ0FBQyxPQUFvQixFQUFFLElBQVk7SUFDN0QsSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0I7UUFBRSxPQUFPLEVBQUUsQ0FBQztJQUNuRCxJQUFNLEdBQUcsR0FBRyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFRLENBQUM7SUFDcEQsT0FBTyxTQUFTLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQzlCLENBQUM7QUFFRDs7OztHQUlHO0FBQ0gsTUFBTSxVQUFVLFdBQVcsQ0FBQyxPQUFvQixFQUFFLEVBQXFDO0lBQ3JGLHFEQUFxRDtJQUNyRCxJQUFNLENBQUMsR0FBRyxPQUFPLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQztJQUNsQyxFQUFFLElBQUkscUJBQXFCLENBQUMsY0FBTSxPQUFBLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBTCxDQUFLLENBQUMsQ0FBQztBQUMzQyxDQUFDO0FBRUQsTUFBTSxVQUFVLEdBQUc7SUFDakIsT0FBTyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7QUFDcEIsQ0FBQztBQUVELElBQU0sWUFBWSxHQUFHLDBFQUEwRSxDQUFDO0FBQ2hHLE1BQU0sVUFBVSxjQUFjLENBQUMsR0FBNkI7SUFDMUQsSUFBSSxRQUFRLEdBQUcsQ0FBQyxDQUFDO0lBQ2pCLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQztJQUNkLElBQUksTUFBTSxHQUFnQixJQUFJLENBQUM7SUFDL0IsSUFBSSxPQUFPLEdBQUcsS0FBSyxRQUFRLEVBQUU7UUFDM0Is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LEVBQUU7UUFDVCxPQUFPLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7S0FDeEM7U0FBTTtRQUNMLE9BQU8sQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO0tBQ3BDO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBHb29nbGUgSW5jLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzIGdvdmVybmVkIGJ5IGFuIE1JVC1zdHlsZSBsaWNlbnNlIHRoYXQgY2FuIGJlXG4gKiBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlIGF0IGh0dHBzOi8vYW5ndWxhci5pby9saWNlbnNlXG4gKi9cbmltcG9ydCB7VGltaW5nfSBmcm9tICcuL2ludGVyZmFjZXMnO1xuaW1wb3J0IHtBVVRPX1NUWUxFfSBmcm9tICcuL3Rva2Vucyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBjb21wdXRlU3R5bGUoZWxlbWVudDogSFRNTEVsZW1lbnQsIHByb3A6IHN0cmluZyk6IHN0cmluZyB7XG4gIGlmICghd2luZG93IHx8ICF3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSkgcmV0dXJuICcnO1xuICBjb25zdCBnY3MgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50KSBhcyBhbnk7XG4gIHJldHVybiByZWFkU3R5bGUoZ2NzLCBwcm9wKTtcbn1cblxuLyoqXG4gKlxuICogQHBhcmFtIGVsZW1lbnRcbiAqIEBwYXJhbSBjYlxuICovXG5leHBvcnQgZnVuY3Rpb24gYXBwbHlSZWZsb3coZWxlbWVudDogSFRNTEVsZW1lbnQsIGNiPzogKChyZWZsb3c6IG51bWJlcikgPT4gYW55KSB8IG51bGwpIHtcbiAgLy8gVE9ETyAobWF0c2tvKTogbWFrZSBzdXJlIHRoaXMgZG9lc24ndCBnZXQgbWluaWZpZWRcbiAgY29uc3QgdyA9IGVsZW1lbnQuY2xpZW50V2lkdGggKyAxO1xuICBjYiAmJiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gY2IodykpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbm93KCk6IG51bWJlciB7XG4gIHJldHVybiBEYXRlLm5vdygpO1xufVxuXG5jb25zdCBUSU1JTkdfUkVHRVggPSAvXigtP1tcXC5cXGRdKykobT9zKSg/OlxccysoLT9bXFwuXFxkXSspKG0/cykpPyg/OlxccysoWy1hLXpdKyg/OlxcKC4rP1xcKSk/KSk/JC9pO1xuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlVGltaW5nRXhwKGV4cDogc3RyaW5nIHwgbnVtYmVyIHwgVGltaW5nKTogVGltaW5nIHtcbiAgbGV0IGR1cmF0aW9uID0gMDtcbiAgbGV0IGRlbGF5ID0gMDtcbiAgbGV0IGVhc2luZzogc3RyaW5nfG51bGwgPSBudWxsO1xuICBpZiAodHlwZW9mIGV4cCA9PT0gJ3N0cmluZycpIHtcbiAgICBjb25zdCBtYXRjaGVzID0gZXhwLm1hdGNoKFRJTUlOR19SRUdFWCk7XG4gICAgaWYgKG1hdGNoZXMgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiB7ZHVyYXRpb246IDAsIGRlbGF5OiAwLCBlYXNpbmc6ICcnLCBmaWxsOiBudWxsfTtcbiAgICB9XG5cbiAgICBkdXJhdGlvbiA9IF9jb252ZXJ0VGltZVZhbHVlVG9NUyhwYXJzZUZsb2F0KG1hdGNoZXNbMV0pLCBtYXRjaGVzWzJdKTtcblxuICAgIGNvbnN0IGRlbGF5TWF0Y2ggPSBtYXRjaGVzWzNdO1xuICAgIGlmIChkZWxheU1hdGNoICE9IG51bGwpIHtcbiAgICAgIGRlbGF5ID0gX2NvbnZlcnRUaW1lVmFsdWVUb01TKHBhcnNlRmxvYXQoZGVsYXlNYXRjaCksIG1hdGNoZXNbNF0pO1xuICAgIH1cblxuICAgIGNvbnN0IGVhc2luZ1ZhbCA9IG1hdGNoZXNbNV07XG4gICAgaWYgKGVhc2luZ1ZhbCkge1xuICAgICAgZWFzaW5nID0gZWFzaW5nVmFsO1xuICAgIH1cbiAgfSBlbHNlIGlmICh0eXBlb2YgZXhwID09PSAnbnVtYmVyJykge1xuICAgIGR1cmF0aW9uID0gZXhwO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IHQgPSBleHAgYXMgVGltaW5nO1xuICAgIGR1cmF0aW9uID0gdC5kdXJhdGlvbjtcbiAgICBkZWxheSA9IHQuZGVsYXkgfHwgMDtcbiAgICBlYXNpbmcgPSB0LmVhc2luZyB8fCBudWxsO1xuICB9XG5cbiAgcmV0dXJuIHtkdXJhdGlvbiwgZGVsYXksIGVhc2luZywgZmlsbDogbnVsbH07XG59XG5cbmNvbnN0IE9ORV9TRUNPTkQgPSAxMDAwO1xuXG5mdW5jdGlvbiBfY29udmVydFRpbWVWYWx1ZVRvTVModmFsdWU6IG51bWJlciwgdW5pdDogc3RyaW5nKTogbnVtYmVyIHtcbiAgLy8gb25seSBzZWNvbmRzIGFyZSB0cmVhdGVkIGluIGEgc3BlY2lhbCB3YXkgLi4uXG4gIC8vIG90aGVyd2lzZSBpdCdzIGFzc3VtZWQgdGhhdCBtaWxsaXNlY29uZHMgYXJlIHVzZWRcbiAgcmV0dXJuIHVuaXQgPT0gJ3MnID8gdmFsdWUgKiBPTkVfU0VDT05EIDogdmFsdWU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhcHBseVRyYW5zaXRpb24oZWxlbWVudDogSFRNTEVsZW1lbnQsIHZhbHVlOiBzdHJpbmcgfCBudWxsKSB7XG4gIHZhbHVlID8gZWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eSgndHJhbnNpdGlvbicsIHZhbHVlKSA6XG4gICAgICAgICAgZWxlbWVudC5zdHlsZS5yZW1vdmVQcm9wZXJ0eSgndHJhbnNpdGlvbicpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVhZFN0eWxlKGVsZW1lbnQ6IEhUTUxFbGVtZW50IHwgQ1NTU3R5bGVEZWNsYXJhdGlvbiwgcHJvcDogc3RyaW5nKSB7XG4gIGNvbnN0IHN0eWxlcyA9IChlbGVtZW50IGluc3RhbmNlb2YgRWxlbWVudCkgPyBlbGVtZW50LnN0eWxlIDogZWxlbWVudDtcbiAgcmV0dXJuIChzdHlsZXMgYXN7W2tleTogc3RyaW5nXTogYW55fSlbcHJvcF0gfHwgc3R5bGVzLmdldFByb3BlcnR5VmFsdWUocHJvcCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoeXBoZW5hdGVQcm9wKHByb3A6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBwcm9wLnJlcGxhY2UoL1thLXpdW0EtWl0vZywgdmFsdWUgPT4gYCR7dmFsdWVbMF19LSR7dmFsdWVbMV0udG9Mb3dlckNhc2UoKX1gKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFwcGx5Q2xhc3NDaGFuZ2VzKFxuICAgIGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBjbGFzc2VzOiB7W2tleTogc3RyaW5nXTogYm9vbGVhbn0sIHJldmVydD86IGJvb2xlYW4sXG4gICAgc3RvcmU/OiB7W2tleTogc3RyaW5nXTogYW55fSB8IG51bGwpIHtcbiAgT2JqZWN0LmtleXMoY2xhc3NlcykuZm9yRWFjaChjbGFzc05hbWUgPT4ge1xuICAgIGNvbnN0IGJvb2wgPSBjbGFzc2VzW2NsYXNzTmFtZV07XG4gICAgZWxlbWVudC5jbGFzc0xpc3QudG9nZ2xlKGNsYXNzTmFtZSwgcmV2ZXJ0ID8gIWJvb2wgOiBib29sKTtcbiAgICBpZiAoc3RvcmUpIHtcbiAgICAgIHN0b3JlW2NsYXNzTmFtZV0gPSByZXZlcnQgPyBmYWxzZSA6IHRydWU7XG4gICAgfVxuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFwcGx5U3R5bGVDaGFuZ2VzKFxuICAgIGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBzdHlsZXM6IHtba2V5OiBzdHJpbmddOiBhbnl9LCBiYWNrdXBTdHlsZXM/OiB7W2tleTogc3RyaW5nXTogYW55fSB8IG51bGwsXG4gICAgcmV2ZXJ0PzogYm9vbGVhbiwgcHJlQ29tcHV0ZWRTdHlsZXM/OiB7W2tleTogc3RyaW5nXTogYW55fSB8IG51bGwsXG4gICAgc3RvcmU/OiB7W2tleTogc3RyaW5nXTogYW55fSB8IG51bGwpIHtcbiAgT2JqZWN0LmtleXMoc3R5bGVzKS5mb3JFYWNoKHByb3AgPT4ge1xuICAgIGxldCB2YWx1ZSA9IHJldmVydCA/IChiYWNrdXBTdHlsZXMgJiYgYmFja3VwU3R5bGVzW3Byb3BdKSA6IHN0eWxlc1twcm9wXTtcbiAgICBpZiAodmFsdWUgJiYgdmFsdWUgPT09IEFVVE9fU1RZTEUpIHtcbiAgICAgIHZhbHVlID0gcHJlQ29tcHV0ZWRTdHlsZXMgJiYgcHJlQ29tcHV0ZWRTdHlsZXNbcHJvcF0gfHwgJyc7XG4gICAgfVxuICAgIGFwcGx5U3R5bGUoZWxlbWVudCwgcHJvcCwgdmFsdWUpO1xuICAgIGlmIChzdG9yZSkge1xuICAgICAgc3RvcmVbcHJvcF0gPSB2YWx1ZSB8fCBudWxsO1xuICAgIH1cbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhcHBseVN0eWxlKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBwcm9wOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcgfCBudWxsKSB7XG4gIGlmICh2YWx1ZSkge1xuICAgIGVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkocHJvcCwgdmFsdWUpO1xuICB9IGVsc2Uge1xuICAgIGVsZW1lbnQuc3R5bGUucmVtb3ZlUHJvcGVydHkocHJvcCk7XG4gIH1cbn1cbiJdfQ==